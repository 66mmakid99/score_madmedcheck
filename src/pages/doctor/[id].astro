---
// src/pages/doctor/[id].astro
import Layout from '../../layouts/Layout.astro';
import TierBadge from '../../components/TierBadge.astro';
import TypeBadge from '../../components/TypeBadge.astro';
import RadarChart from '../../components/RadarChart';
import { getDoctorById, getAllDoctorIds } from '../../lib/supabase';
import { TIER_INFO, TYPE_INFO } from '../../lib/types';

export const prerender = true;

export async function getStaticPaths() {
  const ids = await getAllDoctorIds();
  
  // ìƒ˜í”Œ ë°ì´í„°ìš© (DB ì—°ê²° ì „)
  const sampleIds = ids.length > 0 ? ids : ['1', '2', '3'];
  
  return sampleIds.map((id) => ({ params: { id } }));
}

const { id } = Astro.params;
const doctor = await getDoctorById(id);

// ìƒ˜í”Œ ë°ì´í„° (DB ì—°ê²° ì „ í…ŒìŠ¤íŠ¸ìš©)
const sampleDoctor = doctor || {
  id: '1',
  hospital_name: 'ì²­ë‹´ Sí´ë¦¬ë‹‰',
  doctor_name: 'ê¹€ëª…ì˜',
  hospital_url: 'https://example.com',
  region: 'ì²­ë‹´ì—­',
  specialist_type: 'í”¼ë¶€ê³¼ì „ë¬¸ì˜',
  years_of_practice: 18,
  has_fellow: true,
  has_phd: true,
  sci_papers_first: 4,
  sci_papers_co: 3,
  volume_awards: 3,
  trainer_count: 5,
  signature_cases: 10000,
  has_safety_record: true,
  kol_count: 8,
  society_count: 4,
  book_count: 1,
  tier: 'Laureate' as const,
  doctor_type: 'Hexagon' as const,
  total_score: 520,
  foundation_score: 86,
  academic_score: 175,
  clinical_score: 230,
  reputation_score: 29,
  verified_facts: [
    '[í•™ìˆ ] SCI ë…¼ë¬¸ 4í¸ ì œ1ì €ì (J Dermatol ë“±)',
    '[í•™ìˆ ] ì˜í•™ë°•ì‚¬ (ì„œìš¸ëŒ€ ì˜ëŒ€)',
    '[ì„ìƒ] ì¨ë§ˆì§€ FLX ê³¨ë“ ë ˆì½”ë“œ 2023',
    '[ì„ìƒ] ìš¸ì„ë¼ ë‹¤ì´ì•„ëª¬ë“œ 2024',
    '[ì„ìƒ] ë¼ì´ë¸Œì„œì €ë¦¬ ê°•ì—° 5íšŒ',
    '[ì„ìƒ] 18ë…„ ë¬´ì‚¬ê³  ê¸°ë¡',
    '[í™œë™] ì•¨ëŸ¬ê°„ í‚¤ë‹¥í„° 2020-2024',
    '[í™œë™] ë©€ì¸  ìë¬¸ìœ„ì›',
  ],
  consulting_comment: 'ëª¨ë“  ì˜ì—­ì—ì„œ ê· í˜•ì¡íŒ ì™„ì „ì²´(Hexagon) ìœ í˜•ì…ë‹ˆë‹¤. í•™ìˆ ê³¼ ì„ìƒ ëª¨ë‘ì—ì„œ ìµœì •ìƒê¸‰ ê¶Œìœ„ë¥¼ ì¸ì •ë°›ê³  ê³„ì‹­ë‹ˆë‹¤.',
  radar_chart_data: { academic: 88, clinical: 92, career: 86, safety: 100, activity: 58 },
  updated_at: '2025-01-19',
};

const tierInfo = TIER_INFO[sampleDoctor.tier];
const typeInfo = TYPE_INFO[sampleDoctor.doctor_type];
---

<Layout title={`${sampleDoctor.doctor_name} ì›ì¥`} description={sampleDoctor.consulting_comment}>
  <!-- ë’¤ë¡œê°€ê¸° -->
  <a href="/" class="inline-flex items-center gap-1 text-white/50 hover:text-white mb-6 text-sm">
    â† TOP 100ìœ¼ë¡œ ëŒì•„ê°€ê¸°
  </a>

  <!-- í”„ë¡œí•„ í—¤ë” -->
  <section class="bg-mmc-secondary rounded-2xl p-6 md:p-8 mb-6">
    <div class="flex flex-col md:flex-row gap-6">
      <!-- ì™¼ìª½: ê¸°ë³¸ ì •ë³´ -->
      <div class="flex-1">
        <div class="flex items-center gap-3 mb-4">
          <TierBadge tier={sampleDoctor.tier} size="lg" />
          <TypeBadge type={sampleDoctor.doctor_type} />
        </div>

        <h1 class="text-3xl font-bold mb-1">{sampleDoctor.doctor_name} ì›ì¥</h1>
        <p class="text-white/60">{sampleDoctor.hospital_name}</p>

        <div class="flex flex-wrap gap-2 mt-4 text-sm text-white/70">
          <span class="bg-white/10 px-3 py-1 rounded-full">{sampleDoctor.specialist_type}</span>
          <span class="bg-white/10 px-3 py-1 rounded-full">{sampleDoctor.region}</span>
          <span class="bg-white/10 px-3 py-1 rounded-full">ê²½ë ¥ {sampleDoctor.years_of_practice}ë…„</span>
          {sampleDoctor.has_phd && <span class="bg-white/10 px-3 py-1 rounded-full">ì˜í•™ë°•ì‚¬</span>}
        </div>

        <!-- ì´ì  -->
        <div class="mt-6 flex items-end gap-2">
          <span class="text-5xl font-display font-black text-mmc-accent">
            {sampleDoctor.total_score.toLocaleString()}
          </span>
          <span class="text-white/40 mb-2">MMC Score</span>
        </div>

        <p class="mt-4 text-white/60 text-sm italic">"{typeInfo.tagline}"</p>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ë ˆì´ë” ì°¨íŠ¸ -->
      <div class="w-full md:w-72">
        <RadarChart client:load data={sampleDoctor.radar_chart_data} />
      </div>
    </div>
  </section>

  <!-- ì ìˆ˜ ìƒì„¸ -->
  <section class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
    <div class="bg-mmc-secondary rounded-xl p-4 text-center">
      <div class="text-2xl font-bold text-type-guardian">{sampleDoctor.foundation_score}</div>
      <div class="text-white/50 text-sm">Foundation</div>
      <div class="text-white/30 text-xs">ê¸°ë³¸ ìê²©</div>
    </div>
    <div class="bg-mmc-secondary rounded-xl p-4 text-center">
      <div class="text-2xl font-bold text-type-scholar">{sampleDoctor.academic_score}</div>
      <div class="text-white/50 text-sm">Academic</div>
      <div class="text-white/30 text-xs">í•™ìˆ  ì—°êµ¬</div>
    </div>
    <div class="bg-mmc-secondary rounded-xl p-4 text-center">
      <div class="text-2xl font-bold text-type-maestro">{sampleDoctor.clinical_score}</div>
      <div class="text-white/50 text-sm">Clinical</div>
      <div class="text-white/30 text-xs">ì„ìƒ ì‹œìˆ </div>
    </div>
    <div class="bg-mmc-secondary rounded-xl p-4 text-center">
      <div class="text-2xl font-bold text-type-pioneer">{sampleDoctor.reputation_score}</div>
      <div class="text-white/50 text-sm">Reputation</div>
      <div class="text-white/30 text-xs">ëŒ€ì™¸ í™œë™</div>
    </div>
  </section>

  <!-- AI ì»¨ì„¤íŒ… ì½”ë©˜íŠ¸ -->
  <section class="bg-gradient-to-r from-mmc-accent/20 to-transparent rounded-xl p-6 mb-6 border border-mmc-accent/30">
    <h3 class="font-bold mb-2 flex items-center gap-2">
      <span>ğŸ¤–</span> AI ë¶„ì„ ì½”ë©˜íŠ¸
    </h3>
    <p class="text-white/80">{sampleDoctor.consulting_comment}</p>
  </section>

  <!-- ê²€ì¦ëœ íŒ©íŠ¸ -->
  <section class="bg-mmc-secondary rounded-xl p-6">
    <h3 class="font-bold mb-4 flex items-center gap-2">
      <span>âœ…</span> ê²€ì¦ëœ ì´ë ¥ ({sampleDoctor.verified_facts.length}ê±´)
    </h3>
    <ul class="space-y-2">
      {sampleDoctor.verified_facts.map((fact: string) => (
        <li class="flex items-start gap-2 text-sm">
          <span class="text-green-400 mt-0.5">âœ“</span>
          <span class="text-white/70">{fact}</span>
        </li>
      ))}
    </ul>
  </section>

  <!-- ë“±ê¸‰/ìœ í˜• ì„¤ëª… -->
  <section class="grid md:grid-cols-2 gap-4 mt-6">
    <div class="bg-mmc-secondary rounded-xl p-5">
      <h4 class="font-semibold mb-2">
        {tierInfo.emoji} {tierInfo.label} ë“±ê¸‰ì´ë€?
      </h4>
      <p class="text-white/60 text-sm">
        {tierInfo.label === 'Laureate' && '500ì  ì´ìƒ. í•™ìˆ ê³¼ ì„ìƒ ëª¨ë‘ì—ì„œ ë…ë³´ì ì¸ ì—…ì ì„ ì´ë£¬ ìµœê³ ì˜ ê¶Œìœ„ìì…ë‹ˆë‹¤.'}
        {tierInfo.label === 'Authority' && '350ì  ì´ìƒ. í•´ë‹¹ ë¶„ì•¼ì˜ íŠ¸ë Œë“œë¥¼ ì£¼ë„í•˜ê³  í•™ìˆ ì  ì˜í–¥ë ¥ì´ í° ì „ë¬¸ê°€ì…ë‹ˆë‹¤.'}
        {tierInfo.label === 'Master' && '200ì  ì´ìƒ. í’ë¶€í•œ ì„ìƒ ê²½í—˜ê³¼ ê²€ì¦ëœ í•™ìˆ  ì—­ëŸ‰ì„ ê°–ì¶˜ ìˆ™ë ¨ì˜ì…ë‹ˆë‹¤.'}
        {tierInfo.label === 'Diplomate' && '100ì  ì´ìƒ. ì „ë¬¸ì˜ ìê²©ì„ ë°”íƒ•ìœ¼ë¡œ ê¸°ë³¸ ì´ìƒì˜ ì—­ëŸ‰ì„ ê²€ì¦ë°›ì€ ì˜ë£Œì¸ì…ë‹ˆë‹¤.'}
      </p>
    </div>
    <div class="bg-mmc-secondary rounded-xl p-5">
      <h4 class="font-semibold mb-2">
        {typeInfo.emoji} {typeInfo.labelKo} ìœ í˜•ì´ë€?
      </h4>
      <p class="text-white/60 text-sm">{typeInfo.tagline}</p>
      <p class="text-white/40 text-xs mt-2">ì¶”ì²œ ëŒ€ìƒ: {
        typeInfo.label === 'Scholar' ? 'ì•ˆì „í•˜ê³  ê²€ì¦ëœ ì‹œìˆ ì„ ì›í•˜ëŠ” ë¶„' :
        typeInfo.label === 'Maestro' ? 'íš¨ê³¼ì™€ í…Œí¬ë‹‰ì„ ì¤‘ì‹œí•˜ëŠ” ë¶„' :
        typeInfo.label === 'Pioneer' ? 'ìµœì‹  ìœ í–‰ ì‹œìˆ ì„ ì›í•˜ëŠ” ë¶„' :
        typeInfo.label === 'Guardian' ? 'í‰ìƒ ì£¼ì¹˜ì˜ë¥¼ ì°¾ëŠ” ë¶„' :
        'êµ­ë‚´ ìµœê³  ê¶Œìœ„ìë¥¼ ì›í•˜ëŠ” ë¶„'
      }</p>
    </div>
  </section>

  <!-- JSON-LD for AEO -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "Physician",
    "name": sampleDoctor.doctor_name,
    "medicalSpecialty": sampleDoctor.specialist_type,
    "worksFor": {
      "@type": "MedicalClinic",
      "name": sampleDoctor.hospital_name,
      "address": sampleDoctor.region
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": sampleDoctor.total_score,
      "bestRating": 1000,
      "worstRating": 0
    }
  })} />
</Layout>
