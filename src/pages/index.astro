---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import DoctorCard from '../components/DoctorCard.astro';
import { getTop100, getStats } from '../lib/supabase';
import { TIER_INFO } from '../lib/types';

const doctors = await getTop100();
const stats = await getStats();

// ìƒ˜í”Œ ë°ì´í„° (Supabase ì—°ê²° ì „ í…ŒìŠ¤íŠ¸ìš©)
const sampleDoctors = doctors.length > 0 ? doctors : [
  {
    id: '1',
    hospital_name: 'ì²­ë‹´ Sí´ë¦¬ë‹‰',
    doctor_name: 'ê¹€ëª…ì˜',
    region: 'ì²­ë‹´ì—­',
    specialist_type: 'í”¼ë¶€ê³¼ì „ë¬¸ì˜',
    years_of_practice: 18,
    tier: 'Laureate',
    doctor_type: 'Hexagon',
    total_score: 520,
    foundation_score: 86,
    academic_score: 175,
    clinical_score: 230,
    reputation_score: 29,
    radar_chart_data: { academic: 88, clinical: 92, career: 86, safety: 100, activity: 58 },
    rank: 1,
  },
  {
    id: '2',
    hospital_name: 'ê°•ë‚¨ í”¼ë¶€ê³¼',
    doctor_name: 'ì´ì‹¤ì¥',
    region: 'ê°•ë‚¨ì—­',
    specialist_type: 'ì¼ë°˜ì˜',
    years_of_practice: 15,
    tier: 'Master',
    doctor_type: 'Maestro',
    total_score: 305,
    foundation_score: 40,
    academic_score: 0,
    clinical_score: 250,
    reputation_score: 15,
    radar_chart_data: { academic: 0, clinical: 100, career: 40, safety: 100, activity: 30 },
    rank: 2,
  },
  {
    id: '3',
    hospital_name: 'ì‹ ì‚¬ ë”ë§ˆí´ë¦¬ë‹‰',
    doctor_name: 'ë°•êµìˆ˜',
    region: 'ì‹ ì‚¬ì—­',
    specialist_type: 'í”¼ë¶€ê³¼ì „ë¬¸ì˜',
    years_of_practice: 12,
    tier: 'Authority',
    doctor_type: 'Scholar',
    total_score: 380,
    foundation_score: 74,
    academic_score: 195,
    clinical_score: 80,
    reputation_score: 31,
    radar_chart_data: { academic: 98, clinical: 32, career: 74, safety: 50, activity: 62 },
    rank: 3,
  },
];
---

<Layout title="TOP 100 ì˜ì‚¬ ë­í‚¹">
  <!-- Hero -->
  <section class="text-center py-12">
    <h1 class="text-4xl md:text-5xl font-display font-black mb-4">
      ì‹¤ë ¥ìœ¼ë¡œ ê²€ì¦ëœ<br />
      <span class="text-mmc-accent">TOP 100</span> ì˜ì‚¬
    </h1>
    <p class="text-white/60 max-w-xl mx-auto">
      ë§ˆì¼€íŒ…ì´ ì•„ë‹Œ ì‹¤ë ¥ìœ¼ë¡œ í‰ê°€í•©ë‹ˆë‹¤.<br />
      í•™ìˆ  ë…¼ë¬¸, ì‹œìˆ  ë³¼ë¥¨, ë™ë£Œ í‰ê°€ ë“± ê°ê´€ì  ë°ì´í„°ë§Œ ë°˜ì˜í•©ë‹ˆë‹¤.
    </p>
  </section>

  <!-- Stats -->
  <section class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
    <div class="bg-mmc-secondary rounded-lg p-4 text-center">
      <div class="text-2xl font-display font-bold">{stats.total || sampleDoctors.length}</div>
      <div class="text-white/50 text-sm">ê²€ì¦ëœ ì˜ì‚¬</div>
    </div>
    <div class="bg-mmc-secondary rounded-lg p-4 text-center">
      <div class="text-2xl font-display font-bold text-tier-laureate">
        {stats.tierCounts?.Laureate || 1}
      </div>
      <div class="text-white/50 text-sm">Laureate</div>
    </div>
    <div class="bg-mmc-secondary rounded-lg p-4 text-center">
      <div class="text-2xl font-display font-bold">{stats.avgScore || 335}</div>
      <div class="text-white/50 text-sm">í‰ê·  ì ìˆ˜</div>
    </div>
    <div class="bg-mmc-secondary rounded-lg p-4 text-center">
      <div class="text-2xl font-display font-bold">ì£¼ê°„</div>
      <div class="text-white/50 text-sm">ì—…ë°ì´íŠ¸ ì£¼ê¸°</div>
    </div>
  </section>

  <!-- ë“±ê¸‰ ê°€ì´ë“œ -->
  <section class="flex flex-wrap justify-center gap-3 mb-8">
    {Object.entries(TIER_INFO).map(([tier, info]) => (
      <div class="flex items-center gap-2 text-sm text-white/60">
        <span>{info.emoji}</span>
        <span class={`text-${info.color}`}>{info.label}</span>
        <span>({info.labelKo})</span>
      </div>
    ))}
  </section>

  <!-- Doctor List -->
  <section>
    <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
      <span>ğŸ†</span> TOP 100 ë­í‚¹
    </h2>

    <div class="space-y-3">
      {sampleDoctors.map((doctor) => (
        <DoctorCard doctor={doctor} />
      ))}
    </div>

    {sampleDoctors.length === 0 && (
      <div class="text-center py-20 text-white/40">
        <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    )}
  </section>

  <!-- CTA -->
  <section class="mt-16 text-center bg-mmc-secondary rounded-2xl p-8">
    <h3 class="text-xl font-bold mb-2">ì˜ì‚¬ì´ì‹ ê°€ìš”?</h3>
    <p class="text-white/60 mb-4">ê°ê´€ì  ë°ì´í„°ë¥¼ ì œì¶œí•˜ê³  ê²€ì¦ë°›ìœ¼ì„¸ìš”.</p>
    <a
      href="/for-doctors"
      class="inline-block bg-mmc-accent text-white px-6 py-2 rounded-full font-semibold hover:bg-mmc-accent/80 transition"
    >
      ë°ì´í„° ì œì¶œí•˜ê¸°
    </a>
  </section>
</Layout>
